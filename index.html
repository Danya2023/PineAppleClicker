<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ананас Кликер</title>
  <style>
    /* Фон задаётся на body */
    body {
      margin: 0;
      padding: 0;
      background: url('assets/Fon.png') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    /* Основной контейнер игры */
    .container {
      width: 100vw;
      height: 100vh;
      padding: 20px;
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    html {
      touch-action: manipulation;
    }
    /* Счётчик */
    .counter {
      font-size: 30px;
      color: #fff;
      font-weight: bold;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
    }
    .coin-icon {
      width: 30px;
      height: 30px;
      margin-right: 5px;
      vertical-align: middle;
    }
    /* Кликабельный ананас */
    .clickable {
      width: 250px;
      cursor: pointer;
      transition: transform 0.3s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .clickable:hover {
      transform: scale(1.1);
    }
    /* Верхние кнопки */
    .top-right {
      position: absolute;
      top: 10px;
      right: 10px;
    }
    .top-button {
      padding: 10px 15px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #2196F3;
      color: #fff;
      transition: background 0.3s ease;
    }
    .top-button:hover {
      background-color: #1976D2;
    }
    .left-button {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 10px 15px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #2196F3;
      color: #fff;
      transition: background 0.3s ease;
    }
    .left-button:hover {
      background-color: #1976D2;
    }
    /* Футер */
    .footer {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .bottom-buttons {
      display: flex;
      gap: 20px;
    }
    /* Общий стиль для кнопок */
    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover {
      transform: scale(1.05);
    }
    .bottom-buttons button {
      background-color: #4CAF50;
      color: #fff;
    }
    .bottom-buttons button:hover {
      background-color: #45a049;
    }
    .daily-button {
      background: linear-gradient(45deg, #FFA500, #FF8C00);
      color: #fff;
    }
    .daily-button:hover {
      background: linear-gradient(45deg, #FF8C00, #FFA500);
    }
    /* Модальные окна */
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 30px 20px;
      border-radius: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      z-index: 100;
      text-align: center;
      width: 90%;
      max-width: 400px;
    }
    .modal button {
      margin-top: 15px;
      background-color: #4CAF50;
      color: #fff;
    }
    .modal button:hover {
      background-color: #45a049;
    }
    /* Анимация маленьких изображений */
    .mini-pineapple {
      position: absolute;
      width: 40px;
      height: 40px;
      transition: transform 1s ease-out, opacity 1s ease-out;
      pointer-events: none;
    }
    /* Фоны и скины в магазине */
    .shop-skin,
    .shop-background {
      width: 100px !important;
      height: 66px !important;
      object-fit: cover;
      border-radius: 10px;
    }
    /* Иконка информации */
    .info-icon {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    /* Вертикальное расположение элементов (один под другим) */
    #backgroundList, #skinList {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    /* Ежедневные задания */
    #dailyTaskModal {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
    }
    .daily-task {
      background: #f0f0f0;
      border-radius: 20px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      text-align: center;
    }
    .daily-task h4 {
      margin: 5px 0;
      font-size: 18px;
      color: #333;
    }
    .daily-task p {
      margin: 5px 0;
      font-size: 16px;
      color: #666;
    }
    .daily-task button {
      margin-top: 10px;
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      border-radius: 20px;
      background: linear-gradient(45deg, #FFA500, #FF8C00);
      color: #fff;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .daily-task button:hover {
      background: linear-gradient(45deg, #FF8C00, #FFA500);
    }
    /* Модальное окно оффлайн дохода */
    #offlineModal {
      background: rgba(0,0,0,0.85);
      color: #fff;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
    }
    #messageModal {
      z-index: 9999;
    }
    #offlineModal button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background: #4CAF50;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Фон задаётся через body -->
  
  <!-- Глобальный обработчик необработанных обещаний и функция форматирования -->
  <script>
    window.addEventListener("unhandledrejection", function(event) {
      console.error("Unhandled promise rejection:", event.reason);
    });
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
  </script>

  <!-- Основной контейнер игры -->
  <div class="container" id="gameContainer">
    <!-- Верхняя левая кнопка: Настройки -->
    <button class="left-button" onclick="openSettingsModal()">Настройки</button>
    <!-- Верхняя правая кнопка: Об авторе -->
    <div class="top-right">
      <button class="top-button" onclick="showCreatorInfo()">Об авторе</button>
    </div>
    
    <!-- Счётчик монет и ананас -->
    <div class="counter">
      <img src="assets/Сoin.png" alt="Монета" class="coin-icon">
      <span id="coins">0</span>
    </div>
    <img src="assets/PineApple.png" class="clickable" id="pineapple" alt="Ананас">
    
    <!-- Футер с кнопками -->
    <div class="footer">
      <div class="bottom-buttons">
        <button onclick="openShopMenu()">Магазин</button>
        <button onclick="openUpgradeMenu()">Улучшения</button>
      </div>
      <button class="daily-button" onclick="openDailyTaskMenu()">Ежедневные задания</button>
    </div>
  </div>

  <!-- Модальное окно для сообщений (также для информации об авторе) -->
  <div class="modal" id="messageModal"></div>

  <!-- Модальные окна магазина и улучшений -->
  <div class="modal" id="shopModal">
    <h3>Магазин</h3>
    <div style="margin-bottom: 15px;">
      <button onclick="openBackgroundMenu()">Фоны</button>
      <button onclick="openSkinMenu()">Скины</button>
    </div>
    <button onclick="closeShopMenu()">Закрыть магазин</button>
  </div>

  <div class="modal" id="upgradeModal">
    <h3>Улучшения</h3>
    <div style="margin-bottom: 15px;">
      <button id="passiveUpgradeBtn" onclick="buyPassiveUpgrade()">Улучшить пассивный доход</button>
      <button id="clickUpgradeBtn" onclick="buyClickUpgrade()">Улучшить клик</button>
    </div>
    <button onclick="closeUpgradeMenu()">Закрыть улучшения</button>
  </div>

  <!-- Меню выбора фонов -->
  <div class="modal" id="backgroundMenu">
    <h3>Выберите фон</h3>
    <div id="backgroundList"></div>
    <button onclick="closeBackgroundMenu()">Закрыть</button>
  </div>

  <!-- Меню выбора скинов -->
  <div class="modal" id="skinMenu">
    <h3>Выберите скин для ананаса</h3>
    <div id="skinList"></div>
    <button onclick="closeSkinMenu()">Закрыть</button>
  </div>

  <div class="modal" id="settingsModal">
    <h3>Настройки музыки</h3>
    <p id="musicStatusText">Музыка включена</p>
    <button onclick="toggleMusic()" id="toggleMusicBtn">Выключить музыку</button>
    <div style="margin-top: 15px;">
      <label for="volumeSlider">Громкость: <span id="volumeValue">100%</span></label>
      <input type="range" id="volumeSlider" min="0" max="100" value="100">
    </div>
    <button onclick="closeSettingsModal()">Закрыть настройки</button>
  </div>

  <div class="modal" id="dailyTaskModal"></div>

  <div class="modal" id="offlineModal"></div>

  <!-- Фоновая музыка -->
  <audio id="bgMusic" loop autoplay muted>
    <source src="assets/music.mp3" type="audio/mpeg">
  </audio>

  <script>
    // Основные переменные игры
    let coins = parseInt(localStorage.getItem("coins")) || 0;
    let baseClickValue = 1;
    let passiveLevel = parseInt(localStorage.getItem("passiveLevel")) || 0;
    let clickUpgradeLevel = parseInt(localStorage.getItem("clickUpgradeLevel")) || 0;
    let clickValue = baseClickValue + clickUpgradeLevel;
    
    let ownedBackgrounds = JSON.parse(localStorage.getItem("ownedBackgrounds")) || ["assets/Fon.png"];
    let selectedBackground = localStorage.getItem("selectedBackground") || "assets/Fon.png";
        
    let ownedSkins = JSON.parse(localStorage.getItem("ownedSkins")) || ["assets/PineApple.png"];
    let selectedSkin = localStorage.getItem("selectedSkin") || "assets/PineApple.png";

    updateCoins();

    // Функция обновления монет с форматированием
    function updateCoins() {
      document.getElementById("coins").textContent = formatNumber(Math.floor(coins));
      localStorage.setItem("coins", coins);
    }

    // Музыкальные настройки
    let musicEnabled = localStorage.getItem("musicEnabled");
    if (musicEnabled === null) {
      musicEnabled = true;
      localStorage.setItem("musicEnabled", "true");
    } else {
      musicEnabled = (musicEnabled === "true");
    }
    const bgMusic = document.getElementById("bgMusic");

    let musicVolume = localStorage.getItem("musicVolume");
    if (musicVolume === null) {
      musicVolume = 1;
      localStorage.setItem("musicVolume", musicVolume);
    } else {
      musicVolume = parseFloat(musicVolume);
    }
    bgMusic.volume = musicVolume;
    if (musicEnabled) {
      bgMusic.play().catch(() => {});
    } else {
      bgMusic.pause();
    }
    document.body.addEventListener('click', function() {
      if (bgMusic.muted) {
        bgMusic.muted = false;
        if (musicEnabled) {
          bgMusic.play();
        }
      }
    }, { once: true });

    // Если устройство iOS, скрываем ползунок громкости и предупреждаем пользователя
    window.addEventListener("load", function() {
      if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        document.getElementById("volumeSlider").style.display = "none";
        alert("Регулировка громкости недоступна на iOS. Используйте системные средства управления громкостью.");
      }
    });

    // Обновление времени при каждом взаимодействии (click и touchstart)
    function updateLastTime() {
      localStorage.setItem("lastTime", Date.now());
    }
    document.addEventListener('click', updateLastTime);
    document.addEventListener('touchstart', updateLastTime);

    // Telegram Web Apps событие закрытия или beforeunload
    if (window.Telegram && window.Telegram.WebApp) {
      window.Telegram.WebApp.onEvent('close', () => {
        localStorage.setItem("lastTime", Date.now());
      });
    } else {
      window.addEventListener("beforeunload", function() {
        localStorage.setItem("lastTime", Date.now());
      });
    }
    // Резервное обновление времени каждую минуту
    setInterval(() => {
      localStorage.setItem("lastTime", Date.now());
    }, 60000);
    
    setInterval(() => {
    updateDailyTask("playTime", 1);
    }, 1000);

    // --- Ежедневные задания ---
    function resetDailyTasksIfNeeded() {
      let today = new Date().toISOString().slice(0, 10);
      let lastReset = localStorage.getItem("lastDailyReset");
      if (lastReset !== today) {
        let dailyTasks = [
          { id: "clicks", description: "Накликать 1000 раз", required: 1000, reward: 5000, progress: 0, claimed: false },
          { id: "playTime", description: "Поиграть 10 минут", required: 600, reward: 3000, progress: 0, claimed: false }
        ];
        localStorage.setItem("dailyTasks", JSON.stringify(dailyTasks));
        localStorage.setItem("lastDailyReset", today);
      }
    }
    function getDailyTasks() {
      resetDailyTasksIfNeeded();
      return JSON.parse(localStorage.getItem("dailyTasks"));
    }
    function updateDailyTask(taskId, increment) {
      let tasks = getDailyTasks();
      tasks.forEach(task => {
        if (task.id === taskId) {
          task.progress += increment;
          if (task.progress > task.required) task.progress = task.required;
        }
      });
      localStorage.setItem("dailyTasks", JSON.stringify(tasks));
    }
    function claimDailyTaskReward(taskId) {
      let tasks = getDailyTasks();
      tasks.forEach(task => {
        if (task.id === taskId && !task.claimed && task.progress >= task.required) {
          coins += task.reward;
          task.claimed = true;
          updateCoins();
          showMessage(`Награда ${formatNumber(task.reward)} монет получена за задание "${task.description}"!`);
        }
      });
      localStorage.setItem("dailyTasks", JSON.stringify(tasks));
    }
    function openDailyTaskMenu() {
      let tasks = getDailyTasks();
      let html = "<h3>Ежедневные задания</h3>";
      tasks.forEach(task => {
        html += `<div class="daily-task">
          <h4>${task.description}</h4>
          <p>Прогресс: ${formatNumber(task.progress)} / ${formatNumber(task.required)}</p>`;
        if (!task.claimed && task.progress >= task.required) {
          html += `<button onclick="claimDailyTaskReward('${task.id}')">Получить награду</button>`;
        } else if(task.claimed) {
          html += `<p>Награда получена</p>`;
        }
        html += `</div>`;
      });
      html += `<button onclick="closeDailyTaskMenu()">Закрыть</button>`;
      document.getElementById("dailyTaskModal").innerHTML = html;
      document.getElementById("dailyTaskModal").style.display = "block";
    }
    function closeDailyTaskMenu() {
      document.getElementById("dailyTaskModal").style.display = "none";
    }
    // --- Конец ежедневных заданий ---

    // Обработка клика по ананасу
    document.getElementById("pineapple").addEventListener("click", function(event) {
      coins += clickValue;
      updateCoins();
      updateDailyTask("clicks", 1);
      this.style.transition = "transform 0.2s ease";
      this.style.transform = "scale(1.2) rotate(10deg)";
      setTimeout(() => {
        this.style.transform = "scale(1) rotate(0deg)";
      }, 200);
      createPineappleExplosion(event.clientX, event.clientY);
    });
    function createPineappleExplosion(x, y) {
      for (let i = 0; i < 10; i++) {
        let miniPineapple = document.createElement("img");
        miniPineapple.src = "assets/PineApple.png"; 
        miniPineapple.classList.add("mini-pineapple");
        document.body.appendChild(miniPineapple);
        let angle = Math.random() * Math.PI * 2;
        let distance = Math.random() * 100 + 50;
        let targetX = x + Math.cos(angle) * distance;
        let targetY = y + Math.sin(angle) * distance;
        miniPineapple.style.left = `${x}px`;
        miniPineapple.style.top = `${y}px`;
        setTimeout(() => {
          miniPineapple.style.transform = `translate(${targetX - x}px, ${targetY - y}px) scale(0.5)`;
          miniPineapple.style.opacity = "0";
        }, 10);
        setTimeout(() => {
          miniPineapple.remove();
        }, 1000);
      }
    }
    setInterval(() => {
      coins += passiveLevel;
      updateCoins();
    }, 1000);

    // Функции модальных окон магазина и улучшений
    function openShopMenu() {
      document.getElementById("shopModal").style.display = "block";
    }
    function closeShopMenu() {
      document.getElementById("shopModal").style.display = "none";
    }
    function openUpgradeMenu() {
      document.getElementById("upgradeModal").style.display = "block";
    }
    function closeUpgradeMenu() {
      document.getElementById("upgradeModal").style.display = "none";
    }
    
    // Функции для работы с фонами
    function openBackgroundMenu() {
      closeShopMenu();
      let menu = document.getElementById("backgroundList");
      menu.innerHTML = "";
      let backgrounds = [
        { price: 100000, path: "assets/FonShop1.png", info: "Лето с интересными тропическими деревьями" },
        { price: 1000000, path: "assets/FonShop2.png", info: "Зима красиво, но холодно" },
        { price: 10000000, path: "assets/FonShop3.png", info: "Горы и машины, что может быть лучше этого" },
        { price: 100000000, path: "assets/FonShop4.png", info: "Марс - неизведанное и таинственное место, ну хоть ананас побывает первым на марсе" }
      ];
      backgrounds.forEach(bg => {
        let bgCard = document.createElement("div");
        // Элементы будут располагаться вертикально
        bgCard.style.display = "flex";
        bgCard.style.flexDirection = "column";
        bgCard.style.alignItems = "center";
        
        let img = document.createElement("img");
        img.src = bg.path;
        img.classList.add("shop-background");
        
        // Добавляем иконку информации
        let infoImg = document.createElement("img");
        infoImg.src = "assets/exclamation mark.png";
        infoImg.classList.add("info-icon");
        infoImg.onclick = function(e) {
          e.stopPropagation();
          showMessage(bg.info);
        };

        let button = document.createElement("button");
        if (ownedBackgrounds.includes(bg.path)) {
          button.textContent = (selectedBackground === bg.path ? "Выбран" : "Выбрать");
        } else {
          button.innerHTML = `Купить за ${formatNumber(bg.price)} <img src="assets/Сoin.png" alt="Монета" style="width:16px; height:16px; vertical-align:middle;">`;
        }
        button.onclick = function() {
          if (!ownedBackgrounds.includes(bg.path)) {
            buyBackground(bg.price, bg.path);
          } else {
            selectBackground(bg.path);
          }
        };
        
        bgCard.appendChild(img);
        bgCard.appendChild(infoImg);
        bgCard.appendChild(button);
        menu.appendChild(bgCard);
      });
      document.getElementById("backgroundMenu").style.display = "block";
    }
    function closeBackgroundMenu() {
      document.getElementById("backgroundMenu").style.display = "none";
    }
    function selectBackground(path) {
      selectedBackground = path;
      localStorage.setItem("selectedBackground", selectedBackground);
      document.getElementById("gameContainer").style.backgroundImage = `url('${selectedBackground}')`;
      closeBackgroundMenu();
    }
    function buyBackground(price, path) {
      if (coins >= price) {
        coins -= price;
        ownedBackgrounds.push(path);
        localStorage.setItem("ownedBackgrounds", JSON.stringify(ownedBackgrounds));
        updateCoins();
        openBackgroundMenu();
      } else {
        showMessage("Не хватает монет для покупки фона!");
      }
    }
    
    // Функции для работы со скинами
    function openSkinMenu() {
  document.getElementById("shopModal").style.display = "none";
  let menu = document.getElementById("skinList");
  menu.innerHTML = "";
  // Добавляем новое свойство shopPath для отображения в магазине
  let skins = [
    { 
      price: 1000000, 
      path: "assets/Skin1.png", 
      shopPath: "assets/Skin1_locked.png", 
      lockedPath: "assets/Skin1_locked.png", 
      info: "Пиксельный ананас" 
    },
    { 
      price: 10000000, 
      path: "assets/Skin2.png", 
      shopPath: "assets/Skin2_locked.png", 
      lockedPath: "assets/Skin2_locked.png", 
      info: "Ананас в стиле модника, красивый и всегда следит за модой" 
    },
    { 
      price: 100000000, 
      path: "assets/Skin3.png", 
      shopPath: "assets/Skin3_locked.png", 
      lockedPath: "assets/Skin3_locked.png", 
      info: "Самый редкий скин в игре - золотой ананас, его имеют только 1% из всех игроков" 
    }
  ];
  skins.forEach(skin => {
    let skinCard = document.createElement("div");
    skinCard.style.display = "flex";
    skinCard.style.flexDirection = "column";
    skinCard.style.alignItems = "center";
    
    let img = document.createElement("img");
    // Если скин куплен, используем специальное изображение для магазина, иначе – изображение заблокированного скина
    img.src = ownedSkins.includes(skin.path) ? skin.shopPath : skin.lockedPath;
    img.classList.add("shop-skin");
    
    // Добавляем иконку информации для скина
    let infoImg = document.createElement("img");
    infoImg.src = "assets/exclamation mark.png";
    infoImg.classList.add("info-icon");
    infoImg.onclick = function(e) {
      e.stopPropagation();
      showMessage(skin.info);
    };

    let button = document.createElement("button");
    if (ownedSkins.includes(skin.path)) {
      button.textContent = (selectedSkin === skin.path ? "Выбран" : "Выбрать");
    } else {
      button.innerHTML = `Купить за ${formatNumber(skin.price)} <img src="assets/Сoin.png" alt="Монета" style="width:16px; height:16px; vertical-align:middle;">`;
    }
    button.onclick = function() {
      if (!ownedSkins.includes(skin.path)) {
        buySkin(skin.price, skin.path);
      } else {
        selectSkin(skin.path);
      }
    };
    
    skinCard.appendChild(img);
    skinCard.appendChild(infoImg);
    skinCard.appendChild(button);
    menu.appendChild(skinCard);
  });
  document.getElementById("skinMenu").style.display = "block";
}

    function closeSkinMenu() {
      document.getElementById("skinMenu").style.display = "none";
    }
    function selectSkin(path) {
      selectedSkin = path;
      localStorage.setItem("selectedSkin", selectedSkin);
      document.getElementById("pineapple").src = selectedSkin;
      closeSkinMenu();
    }
    function buySkin(price, path) {
      if (coins >= price) {
        coins -= price;
        ownedSkins.push(path);
        localStorage.setItem("ownedSkins", JSON.stringify(ownedSkins));
        updateCoins();
        openSkinMenu();
      } else {
        showMessage("Не хватает монет для покупки скина!");
      }
    }
    
    // Функции для улучшений
    function buyPassiveUpgrade() {
      let cost = 50 * (passiveLevel + 1);
      if (coins >= cost) {
        coins -= cost;
        passiveLevel++;
        localStorage.setItem("passiveLevel", passiveLevel);
        updateCoins();
        updateUpgradeButtons();
      } else {
        showMessage("Не хватает монет для улучшения пассивного дохода!");
      }
    }
    function buyClickUpgrade() {
      let cost = 50 * (clickUpgradeLevel + 1);
      if (coins >= cost) {
        coins -= cost;
        clickUpgradeLevel++;
        clickValue = baseClickValue + clickUpgradeLevel;
        localStorage.setItem("clickUpgradeLevel", clickUpgradeLevel);
        updateCoins();
        updateUpgradeButtons();
      } else {
        showMessage("Не хватает монет для улучшения клика!");
      }
    }
    function updateUpgradeButtons() {
      let passiveBtn = document.getElementById("passiveUpgradeBtn");
      let clickBtn = document.getElementById("clickUpgradeBtn");
      let passiveCost = 50 * (passiveLevel + 1);
      let clickCost = 50 * (clickUpgradeLevel + 1);
      passiveBtn.innerHTML = `Улучшить пассивный доход (Уровень: ${passiveLevel}, Цена: ${formatNumber(passiveCost)} <img src="assets/Сoin.png" alt="Монета" style="width:16px; height:16px; vertical-align:middle;">)`;
      clickBtn.innerHTML = `Улучшить клик (Уровень: ${clickUpgradeLevel}, Цена: ${formatNumber(clickCost)} <img src="assets/Сoin.png" alt="Монета" style="width:16px; height:16px; vertical-align:middle;">)`;
    }
    function showMessage(msg) {
      let modal = document.getElementById("messageModal");
      modal.innerHTML = `<p id="messageText">${msg}</p>
                           <button onclick="closeMessage()">Закрыть</button>`;
      modal.style.display = "block";
    }
    function closeMessage() {
      document.getElementById("messageModal").style.display = "none";
    }
    function showCreatorInfo() {
      let modal = document.getElementById("messageModal");
      modal.innerHTML = `<h3>Об авторе</h3>
                         <p>Создатель игры: ананасик версия 1.0</p>
                         <div style="margin-top:10px;">
                           <a href="https://www.youtube.com/@AnanasicChickenGun" target="_blank">
                             <img src="assets/youtube.png" alt="YouTube" style="width:50px; height:50px;">
                           </a>
                         </div>
                         <button onclick="closeMessage()">Закрыть</button>`;
      modal.style.display = "block";
    }
    function openSettingsModal() {
      updateMusicStatus();
      document.getElementById("settingsModal").style.display = "block";
    }
    function closeSettingsModal() {
      document.getElementById("settingsModal").style.display = "none";
    }
    function updateMusicStatus() {
      const statusText = document.getElementById("musicStatusText");
      const toggleBtn = document.getElementById("toggleMusicBtn");
      if (musicEnabled) {
        statusText.textContent = "Музыка включена";
        toggleBtn.textContent = "Выключить музыку";
      } else {
        statusText.textContent = "Музыка выключена";
        toggleBtn.textContent = "Включить музыку";
      }
    }
    function toggleMusic() {
      musicEnabled = !musicEnabled;
      localStorage.setItem("musicEnabled", musicEnabled ? "true" : "false");
      if (musicEnabled) {
        bgMusic.play();
      } else {
        bgMusic.pause();
      }
      updateMusicStatus();
    }
    document.getElementById("volumeSlider").addEventListener("input", function() {
      let volume = this.value / 100;
      bgMusic.volume = volume;
      localStorage.setItem("musicVolume", volume);
      document.getElementById("volumeValue").textContent = `${this.value}%`;
    });
    window.addEventListener("load", function() {
      document.getElementById("gameContainer").style.backgroundImage = `url('${selectedBackground}')`;
      document.getElementById("pineapple").src = selectedSkin;
      updateUpgradeButtons();
      const volumeSlider = document.getElementById("volumeSlider");
      volumeSlider.value = bgMusic.volume * 100;
      document.getElementById("volumeValue").textContent = `${volumeSlider.value}%`;
    });
    window.addEventListener("load", function() {
      const lastTime = localStorage.getItem("lastTime");
      if (lastTime) {
        const timeDifference = Date.now() - parseInt(lastTime);
        const secondsAway = Math.floor(timeDifference / 1000);
        const offlineCoins = secondsAway * passiveLevel;
        if (offlineCoins > 0) {
          showOfflineEarnings(offlineCoins);
        }
      }
    });
    function showOfflineEarnings(earned) {
      let offlineModal = document.getElementById("offlineModal");
      let secondsAway = passiveLevel > 0 ? earned / passiveLevel : 0;
      offlineModal.innerHTML = `
        <h3>Оффлайн доход</h3>
        <p>Вы отсутствовали ${Math.floor(secondsAway)} секунд и заработали ${formatNumber(earned)} монет!</p>
        <button onclick="claimOfflineEarnings(${earned})">Забрать доход</button>
        <button onclick="closeOfflineModal()">Отмена</button>
      `;
      offlineModal.style.display = "block";
    }
    function claimOfflineEarnings(earned) {
      coins += earned;
      updateCoins();
      closeOfflineModal();
      showMessage(`Вы получили ${formatNumber(earned)} монет за оффлайн время!`);
      localStorage.setItem("lastTime", Date.now());
    }
    function closeOfflineModal() {
      document.getElementById("offlineModal").style.display = "none";
    }
    window.addEventListener("beforeunload", function() {
      localStorage.setItem("lastTime", Date.now());
    });
  </script>
</body>
</html>

